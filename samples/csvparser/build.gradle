plugins {
    id 'kotlin-multiplatform'
}

kotlin {
    sourceSets {
        csvParser

        macosMain { dependsOn csvParser }
        linuxMain { dependsOn csvParser }
        mingwMain { dependsOn csvParser }
    }

    targets {
        fromPreset(presets.macosX64, 'macos')
        fromPreset(presets.linuxX64, 'linux')
        fromPreset(presets.mingwX64, 'mingw')

        configure([macos, linux, mingw]) {
            compilations.main.outputKinds('EXECUTABLE')
            compilations.main.entryPoint = 'sample.csvparser.main'
        }

        createRunTask(this, 'runProgram', [macos, linux, mingw].find { it.publishable }) {
            args './European_Mammals_Red_List_Nov_2009.csv', 4, 100
        }
    }
}
